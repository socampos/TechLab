---
- name: Playbook to handle users
  hosts: Lab
  become: true
  collections:
    - freeipa.ansible_freeipa
    
  vars:
    si: "SI"
    
  tasks:
  - name: Modificar Nombre.
    ipauser:
      ipaadmin_password: techadmin1234
      name: "{{ username }}"
      first: "{{ nombre }}"
      update_password: on_create
    when:  nombre|string | length > 0
      
  - name: Modificar apellido.
    ipauser:
      ipaadmin_password: techadmin1234
      name: "{{ username }}"
      last: "{{ apellido }}"
      update_password: on_create
    when:  apellido|string | length > 0
  
  - name: Modificar pass.
    ipauser:
      ipaadmin_password: techadmin1234
      name: "{{ username }}"
      password: "{{ pass }}"
      update_password: on_create
    when:  pass|string | length > 0

  - name: Es admin
    ipagroup:
      ipaadmin_password: techadmin1234
      name: admins
      action: member
      user:
      - "{{ username }}"
    when: admin|string == "SI"

  - name: No es admin 
    ipagroup:
      ipaadmin_password: techadmin1234
      name: admins
      action: member
      user:
      - "{{ username }}"
      state: absent 
    when: admin|string == "NO"
    
  - name: rebuild user
    ipaautomember:
      ipaadmin_password: techadmin1234
      users:
      - "{{ username }}"
      state: rebuilt

# VOY A AGREGARLE EL REBUILD AL FINAL.
